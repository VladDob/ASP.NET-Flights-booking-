@{
    ViewData["Title"] = "Admin";
}


<div class="optionAdmin">Flights</div>



<section style="display:grid; text-align:center;">
    <form id="newFlightForm">
        <div class="inputs">
            <label for="departure" class="label">Departure</label>
            <input type="text" name="departure"  id="departure" class="input" style="width: 100px" required>
        </div>
        <div class="inputs">
            <label for="destination" class="label">Destination</label>
            <input type="text" name="destination" id="destination" class="input" style="width: 100px" required>
        </div>

        <div class="inputs">
            <div class="Departure">
                <label for="Capacity" class="label">Capacity</label>
                <input type="text" name="capacity" id="capacity" class="input" style="width: 100px" required>
            </div>
        </div>

        <div class="inputs">
            <div class="Return">
                <label for="Deptime" class="label">Dep. time</label>
                <input type="date"name="deptime" id="deptime" class="input" style="width: 100px" required>
            </div>
        </div>

        <div class="inputs">
            <div class="Return">
                <label for="Arrtime" class="label">Arr. time</label>
                <input type="date" name="arrtime" id="arrtime" class="input" style="width: 100px" required>
            </div>
        </div>
        <div class="inputs">
            <div class="Return">
                <label for="Planetype" class="label">Plane type</label>
                <input type="text" name="planetype" id="planetype" class="input" style="width: 100px" required>
            </div>
        </div>
        <div class="inputs">
           
            <input type="submit" value="Add" class="button" onclick="AddFlight()">
        </div>
    </form>
   
    <div class="fieldsHead">
        <div class="details">
            <div class="field"> Flight No.</div>
            <div class="field"> Departure</div>
            <div class="field"> Destination</div> <!--Arrival-->
            <div class="field"> Capacity </div>
            <div class="field"> Dep. time </div>
            <div class="field"> Arr. time</div>
            <div class="field"> Plane type</div>
        </div>
    </div>
    <div class="flightsSection" style="text-align:center; margin:auto" id="flightsSelect">
    </div>

</section>

<br>
<div class="optionAdmin">Reservations</div>
<section style="display:grid; text-align:center;">
   
    <div class="fieldsHead">
        <div class="details">
            <div class="field"> ID</div>
            <div class="field"> Date</div>
            <div class="field"> Class</div> 
            <div class="field"> Seats</div>
            
        </div>
    </div>
    <div class="flightsSection" style="text-align:center; margin:auto" id="reservationsSelect">
    </div>

</section>


<!--<button id="saveBtn" type="submit" class="btn btn-primary">Save</button>-->

@section Scripts {


    <script type="text/javascript">


        function populateFlights() {
            $.ajax({
                url: "/Flights/FindFlights",
                type: "POST",
                data: {},
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function (flightsResponse) {
                    $("#flightsSelect").empty();
                    console.log(flightsResponse);
                    $(flightsResponse).each(function (index, element) {
                        console.log(element);
                        $("#flightsSelect").append(
                            '<div class="fields" >' +
                            '<div class="details">' +
                            '<div class="field' +' '+ element.number + '" id="num">' + element.number + '</div>' +
                            '<div class="field' + ' ' + element.number + '" id="dep">' + element.departure + '</div>' +
                            '<div class="field' + ' ' + element.number + '" id="arr">' + element.arrival + '</div>' +
                            '<div class="field' + ' ' + element.number + '" id="cap">' + element.capacity + '</div>' +
                            '<div class="field' + ' ' + element.number + '" id="dept">' + element.departure_time + '</div>' +
                            '<div class="field' + ' ' +element.number + '" id="arrt">' + element.arrival_time + '</div>' +
                            //'<div class="field">' + element.departure_date + '</div>' +
                            //'<div class="field">' + element.arrival_date + '</div>' +
                            '<div class="field' + ' ' + element.number + '" id="ptype">' + element.plane_type + '</div>' +
                            '<button type="submit" class="button" onclick="RemoveFlight(' + element.number + ')" style="width:70px; margin: 0; position: absolute; height:16px; background-color:#e60000;">Delete</button>'
                            +
                            '</div>' +
                           
                            '</div>' 
                            
                        );
                        console.log(element.number);
                    });

                },
                error: function () {
                    $("#flightsSelect").empty();
                }
            });
        }
        populateFlights();

        function populateReservations() {
            $.ajax({
                url: "/Admin/FindReservation",
                type: "POST",
                data: {},
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function (reservationsResponse) {
                    $("#reservationsSelect").empty();
                    console.log(reservationsResponse);
                    $(reservationsResponse).each(function (index, element) {
                        console.log(element);
                        $("#reservationsSelect").append(
                            '<div class="fields" >' +
                            '<div class="details">' +
                            '<div class="field">' + element.id + '</div>' +
                            '<div class="field">' + element.date + '</div>' +
                            '<div class="field">' + element.class + '</div>' +
                            '<div class="field">' + element.reservedSeats + '</div>' +
                            '<button type="submit" class="button" style="width:70px;  position: absolute; height:16px; margin: 0">Edit</button>'
                                    +
                            '</div>' +
                            '</div>'
                           
                        );
                        console.log(element.id);
                    });

                },
                error: function () {
                    $("#reservationsSelect").empty();
                }
            });
        }
        populateReservations();

        function AddFlight() {
            var departure = $("#departure").val();
            var destination = $("#destination").val();
            var capacity = $("#capacity").val();
            var deptime = $("#deptime").val();
            var arrtime = $("#arrtime").val();
            var planetype = $("#planetype").val();

            //var data = $("#newFlightForm").serialize();
            data = { "departure": departure, "arrival": destination, "capacity": capacity, "departure_time": deptime, "arrival_time": arrtime, "departure_date": 0, "arrival_date": 0, "plane_type": planetype }
            console.log(data);
            //alert(data);
            $.ajax({
                type: "POST",
                url: "/Flights/AddFlight",
                data: data,
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                success: function (result) {
                    populateFlights();
                    alert('Successfully received Data ');
                    console.log(result);
                },
                error: function () {
                    alert('Failed to receive the Data');
                    console.log('Failed ');
                }
            })
            populateFlights();
        }

        function RemoveFlight(elementnumber) {
            
            console.log("class name=" + elementnumber);
            var number =        $('#num.'+ elementnumber).text();
            var departure = $('#dep.' + elementnumber).text();
            var destination = $('#arr.' + elementnumber).text();
            var capacity = $('#cap.' + elementnumber).text();
            var deptime = $('#dept.' + elementnumber).text();
            var arrtime = $('#arrt.' + elementnumber).text();
            var planetype = $('#ptype.' + elementnumber).text();

            console.log(number + departure + destination + capacity + deptime + arrtime + planetype);
            data = { "number": number, "departure": departure, "arrival": destination, "capacity": capacity, "departure_time": deptime, "arrival_time": arrtime, "departure_date": 0, "arrival_date": 0, "plane_type": planetype }
            $.ajax({
                type: "POST",                  
                url: "/Flights/RemoveFlights",  
                data: data,
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                beforeSend: function () {
                    return confirm("Are you sure you want to delete this item?");
                },
                success: function (result) {

                    alert('Successfully deleted Data ');
                    console.log(result);
                    populateFlights();
                },
                error: function () {
                    alert('Failed to delete the Data');
                    console.log('Failed ');
                }
            })
        }
    
    </script>
}







